"use strict";(self.webpackChunkcsgoroll=self.webpackChunkcsgoroll||[]).push([["default-libs_quick-upgrade_src_index_ts"],{5858:(ie,L,a)=>{a.r(L),a.d(L,{QuickUpgradeModalComponent:()=>E,QuickUpgradeModule:()=>ce,QuickUpgradeService:()=>Q,QuickUpgradeSharedModule:()=>ge,UpgradeState:()=>p});var m=a(69808),c=a(23600),w=a(57994),P=a.n(w),C=a(63900),M=a(54004),Z=a(95642),e=a(5e3),oe=a(13302);let Q=(()=>{class t{constructor(n,o,r){this.appConfig=n,this.apollo=o,this.userService=r;const{houseEdge:s,multiplierMin:g,multiplierMax:d,maxPot:h}=this.appConfig.quickUpgrade;this.houseEdge=s,this.maxPot=h,this.multiplierMin=g||1,this.multiplierMax=d||100}getMultiplierFromValues(n,o){return+P()(o).div(n)}getChanceFromValues(n,o){return+P()(100).minus(this.houseEdge).div(this.getMultiplierFromValues(n,o)).round(8,0)}getMaxMultiplier(n){return+P()(this.maxPot).div(n)}getMinPotentialValue(n,o){return n*o}getPotentialItems(n,o){return this.userService.market$.pipe((0,C.w)(r=>this.apollo.query({query:c.U$y,variables:{marketId:r.id,maxValue:o,obtainable:!0,orderBy:"VALUE_DESC",first:1}})),(0,M.U)(({data:r})=>{const s=r.itemVariants.edges.map(h=>h.node);if(!s.length)return null;const[g]=s,{value:d}=g||{value:0};return n<d?g:null}))}upgradeItem(n){return this.apollo.mutate({mutation:Z.Eh,variables:{input:n}}).pipe((0,M.U)(({data:o})=>o||null))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(c.qBz),e.LFG(oe._M),e.LFG(c.KDu))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();var $=a(45990),ae=a(99623),re=a(50637);let ce=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[Q],imports:[[m.ez,$.vY,re.hv,ae.$M]]}),t})();var se=a(88279),le=a(5396),Y=a(17067);let ge=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[$.vY,se.p0,le.UserItemSharedModule,Y.DiceSharedModule]]}),t})();var b=a(70655),N=a(93075),U=a(48966),de=a(6535),X=a(93597),R=a(46082),F=a(86513),A=a(44987),W=a(52457),K=a(39646),u=a(61135),y=a(77579),j=a(68675),z=a(39300),_e=a(39841),x=a(18505),ue=a(78372),V=a(71884),q=a(95698),me=a(4128),pe=a(28746),_=(()=>{return(t=_||(_={}))[t.RESET=0]="RESET",t[t.SUCCESS=1]="SUCCESS",t[t.FAIL=2]="FAIL",_;var t})(),p=(()=>{return(t=p||(p={}))[t.INPUT=0]="INPUT",t[t.UPGRADING=1]="UPGRADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAIL=3]="FAIL",p;var t})(),H=a(20820),ee=a(20975),he=a(47423),fe=a(31495),Ce=a(96298),te=a(9124),Me=a(17445),Ue=a(70029),xe=a(82722),Ie=a(38502),ne=a(97272),D=a(4326),B=a(49770),I=a(60515),G=a(46590);function Ae(t,i){if(1&t&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.Q6J("@fadeInDownOnEnter",void 0),e.xp6(1),e.hij("",n,"%")}}function Se(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Ae,2,2,"span",3),e.BQk()),2&t){const n=i.$implicit;e.xp6(1),e.Q6J("ngIf",n>=10)}}let S=class{constructor(){this.state$=new y.x,this.animationCancel$=null,this.animationColor$=new u.X(null),this.isAnimating$=new u.X(!1),this.animationFinished=new e.vpe,this.top$=new u.X(0),this.topDisplay$=this.top$.pipe((0,V.x)(),(0,M.U)(i=>100-i+"%")),this.progress$=new u.X(0),this.progressDisplay$=this.progress$.pipe((0,V.x)()),this.easeIn=i=>Math.pow(i,1.675)}set state(i){this.state$.next(i)}animateNext(i,n,o=2e3,r=this.easeIn){const s=n-i,g=new y.x;let d=null;return(0,Me.F)(0,Ue.Z).pipe((0,x.b)(()=>{d||(d=(new Date).getTime(),this.animationCancel$=new y.x,this.top$.next(n));const h=(new Date).getTime()-d,O=Math.min(h/o,1),T=r(O);this.progress$.next(Math.floor(T*s+i)),T>=1&&(g.next(),g.complete())}),(0,xe.R)(g),(0,Ie.l)())}ngOnInit(){const i=n=>{switch(n){case _.SUCCESS:const o=(0,c.XFR)(1,10)+20,r=(0,c.XFR)(1,20)+65;return this.isAnimating$.next(!0),(0,ne.z)(this.animateNext(0,o).pipe((0,D.g)(100)),this.animateNext(o,r),(0,B.P)(()=>(I.E.pipe((0,G.d)(void 0),(0,D.g)(1500),(0,A.t)(this),(0,x.b)(()=>{this.animationColor$.next("won")})).subscribe(),I.E)),this.animateNext(r,100),I.E.pipe((0,G.d)(void 0),(0,D.g)(100)),(0,B.P)(()=>(this.isAnimating$.next(!1),this.progress$.next(0),this.animationColor$.next("won-border"),this.animationFinished.next(),I.E)));case _.FAIL:const s=(0,c.XFR)(1,10)+20,g=(0,c.XFR)(1,20)+65,d=(0,c.XFR)(5,14)+g;return this.isAnimating$.next(!0),(0,ne.z)(this.animateNext(0,s).pipe((0,D.g)(100)),this.animateNext(s,g),(0,B.P)(()=>(I.E.pipe((0,G.d)(void 0),(0,D.g)(1500),(0,A.t)(this),(0,x.b)(()=>{this.animationColor$.next("fail")})).subscribe(),I.E)),this.animateNext(g,d),(0,B.P)(()=>(this.isAnimating$.next(!1),this.animationFinished.next(),I.E)));default:return I.E.pipe((0,G.d)(void 0),(0,x.b)(()=>{this.top$.next(0),this.progress$.next(0),this.animationColor$.next(null)}))}};this.state$.pipe((0,C.w)(n=>{var o,r;return this.animationCancel$&&(null===(o=this.animationCancel$)||void 0===o||o.next(),null===(r=this.animationCancel$)||void 0===r||r.complete(),this.animationCancel$=null),i(n)}),(0,A.t)(this)).subscribe()}};S.\u0275fac=function(i){return new(i||S)},S.\u0275cmp=e.Xpm({type:S,selectors:[["cw-upgrade-loader"]],inputs:{state:"state"},outputs:{animationFinished:"animationFinished"},ngContentSelectors:["*"],decls:11,vars:28,consts:[[1,"upgrade-loader"],[1,"upgrade-loader-bar"],[4,"rxLet"],[4,"ngIf"]],template:function(i,n){1&i&&(e.F$t(),e.TgZ(0,"div",0),e.ALo(1,"push"),e.Hsn(2),e.TgZ(3,"div",1),e.ALo(4,"push"),e.ALo(5,"push"),e.ALo(6,"push"),e.ALo(7,"push"),e.ALo(8,"push"),e.ALo(9,"push"),e.YNc(10,Se,2,1,"ng-container",2),e.qZA(),e.qZA()),2&i&&(e.ekj("animate",e.lcZ(1,14,n.isAnimating$)),e.xp6(3),e.Udp("top",e.lcZ(4,16,n.topDisplay$)),e.ekj("won","won"===e.lcZ(5,18,n.animationColor$))("won-border","won-border"===e.lcZ(6,20,n.animationColor$))("fail","fail"===e.lcZ(7,22,n.animationColor$))("animate",e.lcZ(8,24,n.isAnimating$)),e.Q6J("@shakeAnimation","fail"===e.lcZ(9,26,n.animationColor$)),e.xp6(7),e.Q6J("rxLet",n.progressDisplay$))},directives:[H.e,m.O5],pipes:[ee.f],styles:[".gaming-site[_nghost-%COMP%]   .upgrade-loader[_ngcontent-%COMP%], .gaming-site   [_nghost-%COMP%]   .upgrade-loader[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden}.gaming-site[_nghost-%COMP%]   .upgrade-loader[_ngcontent-%COMP%]:not(.animate), .gaming-site   [_nghost-%COMP%]   .upgrade-loader[_ngcontent-%COMP%]:not(.animate){overflow:visible}.gaming-site[_nghost-%COMP%]   .won-border[_ngcontent-%COMP%], .gaming-site   [_nghost-%COMP%]   .won-border[_ngcontent-%COMP%]{border-radius:8px}@keyframes upgrade-loader-stripes{0%{background-position:0 0}to{background-position:5rem 0}}.upgrade-loader[_ngcontent-%COMP%]{position:relative;height:100%;width:100%}.upgrade-loader-bar[_ngcontent-%COMP%]{display:flex;position:absolute;left:0;right:0;bottom:0;flex-direction:column;justify-content:center;color:#fff;text-align:center;background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-size:5rem 5rem;z-index:100;background-color:var(--quick-upgrade-default-bg);box-shadow:0 0 0 0 transparent}.animate[_ngcontent-%COMP%]{transition:top 2s ease-in,background-color .5s ease-in,box-shadow .5s ease-in;animation:upgrade-loader-stripes 1s linear infinite}.won[_ngcontent-%COMP%]{background-color:var(--quick-upgrade-won-bg)}.fail[_ngcontent-%COMP%]{background-color:var(--quick-upgrade-fail-bg)}.won-border[_ngcontent-%COMP%]{background-color:transparent;background:transparent;transition:box-shadow .5s ease-in;box-shadow:0 0 1rem .2rem var(--quick-upgrade-won-bg)}"],data:{animation:[(0,te.cI)({duration:500}),(0,te.Ao)({anchor:"shakeAnimation",direction:"=>",delay:500,duration:150,translate:"8px"})]}}),S=(0,b.gn)([(0,A.c)(),(0,b.w6)("design:paramtypes",[])],S);var Te=a(63393),ve=a(46907),Oe=a(48194),Pe=a(89847),Qe=a(79586),De=a(30152),Le=a(17150),$e=a(2620);const be=["userItemsTpl"];function Ne(t,i){1&t&&(e.TgZ(0,"span",30),e._uU(1," \xa0 "),e.TgZ(2,"button",31),e._UZ(3,"cw-icon",32),e.qZA(),e.qZA())}function Re(t,i){1&t&&(e._UZ(0,"cw-icon",33),e.ALo(1,"async"),e.ALo(2,"themableAsset")),2&t&&e.Q6J("inlineSVG",e.lcZ(1,1,e.lcZ(2,3,"assets/icons/close-modal.svg")))}function ye(t,i){1&t&&e.GkF(0)}function Be(t,i){1&t&&(e.ynx(0),e._UZ(1,"cw-icon",34),e.BQk())}function Ge(t,i){1&t&&e._UZ(0,"cw-icon",35)}function ke(t,i){1&t&&e.GkF(0)}const we=function(t,i){return{itemVariant:t,remainderInCoins:i}};function Ze(t,i){if(1&t&&(e.ynx(0),e.YNc(1,ke,1,0,"ng-container",37),e.BQk()),2&t){const n=e.oxw(3).$implicit,o=e.oxw().$implicit;e.oxw(2);const r=e.MAs(37);e.xp6(1),e.Q6J("ngTemplateOutlet",r)("ngTemplateOutletContext",e.WLB(2,we,o,n))}}function Fe(t,i){1&t&&e.GkF(0)}const Ke=function(t){return{balance:t}};function Ve(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Fe,1,0,"ng-container",37),e.BQk()),2&t){const n=e.oxw(3).$implicit;e.oxw(3);const o=e.MAs(41);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,Ke,n))}}function Je(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Ze,2,5,"ng-container",23),e.YNc(2,Ve,2,4,"ng-container",23),e.BQk()),2&t){const n=e.oxw(3).$implicit;e.xp6(1),e.Q6J("ngIf",n),e.xp6(1),e.Q6J("ngIf",!n)}}function Ye(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Je,3,2,"ng-container",14),e.BQk()),2&t){const n=e.oxw(3).$implicit;e.oxw();const o=e.MAs(43);e.xp6(1),e.Q6J("ngIf",!n)("ngIfElse",o)}}function Xe(t,i){if(1&t){const n=e.EpF();e.ynx(0),e.TgZ(1,"cw-upgrade-loader",36),e.NdJ("animationFinished",function(){return e.CHM(n),e.oxw(3).animationFinished()}),e.ALo(2,"push"),e.YNc(3,Ye,2,2,"ng-container",23),e.qZA(),e.BQk()}if(2&t){const n=e.oxw(3);e.xp6(1),e.Q6J("state",e.lcZ(2,2,n.upgradeLoaderState$)),e.xp6(2),e.Q6J("ngIf",n.multiplierFormControl.valid)}}function We(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Xe,4,4,"ng-container",17),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("rxLet",n.remainderInCoins$)}}function je(t,i){if(1&t&&(e.ynx(0),e.YNc(1,We,2,1,"ng-container",17),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("rxLet",n.upgradeItemVariant$)}}function ze(t,i){1&t&&(e.ynx(0),e._uU(1," Attempting upgrade..."),e.BQk())}function qe(t,i){1&t&&(e.ynx(0),e._uU(1," Success!"),e.BQk())}function He(t,i){1&t&&(e.ynx(0),e._uU(1," The Upgrade Failed"),e.BQk())}function et(t,i){1&t&&e.GkF(0)}function tt(t,i){if(1&t&&(e.ynx(0),e.YNc(1,et,1,0,"ng-container",12),e.BQk()),2&t){e.oxw(3);const n=e.MAs(45);e.xp6(1),e.Q6J("ngTemplateOutlet",n)}}function nt(t,i){if(1&t&&(e.TgZ(0,"div",38),e.TgZ(1,"h3",43),e.ynx(2,20),e.YNc(3,ze,2,0,"ng-container",21),e.YNc(4,qe,2,0,"ng-container",21),e.YNc(5,He,2,0,"ng-container",21),e.BQk(),e.qZA(),e.YNc(6,tt,2,1,"ng-container",23),e.qZA()),2&t){const n=e.oxw().$implicit,o=e.oxw();e.xp6(2),e.Q6J("ngSwitch",n),e.xp6(1),e.Q6J("ngSwitchCase",o.UpgradeState.UPGRADING),e.xp6(1),e.Q6J("ngSwitchCase",o.UpgradeState.SUCCESS),e.xp6(1),e.Q6J("ngSwitchCase",o.UpgradeState.FAIL),e.xp6(1),e.Q6J("ngIf",n===o.UpgradeState.SUCCESS||n===o.UpgradeState.FAIL)}}const it=function(){return[1]};function ot(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"div",38),e.TgZ(2,"label",39),e.SDv(3,40),e.qZA(),e._UZ(4,"cw-amount-input",41),e.ALo(5,"async"),e.ALo(6,"themableAsset"),e.qZA(),e.YNc(7,nt,7,5,"div",42),e.BQk()),2&t){const n=i.$implicit,o=e.oxw();e.xp6(1),e.ekj("d-none",n!==o.UpgradeState.INPUT),e.xp6(3),e.Q6J("ctrl",o.multiplierFormControl)("minValue",o.minBet)("smallButtons",!0)("options",e.DdM(20,it))("hideWhenLTLG",!1)("addAndSubtractButton",!1)("lastButton",!1)("clearButton",!1)("maxButton",!1)("doubleAndHalfButton",!0)("label",!1)("errors",o.customErrors)("icon",e.lcZ(5,16,e.lcZ(6,18,"assets/icons/close.svg"))),e.xp6(3),e.Q6J("ngIf",n!==o.UpgradeState.INPUT)}}function at(t,i){1&t&&e._UZ(0,"cw-icon",48)}function rt(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"span",49),e._uU(2),e.ALo(3,"number"),e.TgZ(4,"span"),e.SDv(5,50),e.qZA(),e.qZA(),e.BQk()),2&t){const n=i.ngIf;e.xp6(2),e.hij("",e.xi3(3,1,n,"1.2-2"),"% ")}}function ct(t,i){if(1&t&&(e.ynx(0),e.YNc(1,rt,6,4,"ng-container",23),e.ALo(2,"push"),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,n.chance$))}}function st(t,i){if(1&t){const n=e.EpF();e.ynx(0),e.ynx(1),e.TgZ(2,"button",44),e.NdJ("click",function(){return e.CHM(n),e.oxw().attemptUpgrade()}),e.ALo(3,"push"),e.ALo(4,"push"),e.YNc(5,at,1,0,"cw-icon",45),e.TgZ(6,"span",46),e.SDv(7,47),e.qZA(),e.YNc(8,ct,3,3,"ng-container",23),e.qZA(),e.BQk(),e.BQk()}if(2&t){const n=e.oxw();e.xp6(2),e.Q6J("disabled",e.lcZ(3,5,n.isLoading$)||e.lcZ(4,7,n.isSubmitting$)),e.xp6(3),e.Q6J("ngIf",n.isEcommerce),e.xp6(1),e.ekj("mr-2",n.isEcommerce),e.xp6(2),e.Q6J("ngIf",n.isEcommerce)}}function lt(t,i){1&t&&e._UZ(0,"cw-icon",48)}function gt(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"button",51),e.YNc(2,lt,1,0,"cw-icon",45),e.TgZ(3,"span",46),e.SDv(4,52),e.qZA(),e.qZA(),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("disabled",!0),e.xp6(1),e.Q6J("ngIf",n.isEcommerce)}}function dt(t,i){1&t&&e._UZ(0,"cw-icon",48)}function _t(t,i){if(1&t){const n=e.EpF();e.ynx(0),e.TgZ(1,"button",53),e.NdJ("click",function(){return e.CHM(n),e.oxw(2).upgradeAgain()}),e.YNc(2,dt,1,0,"cw-icon",45),e.TgZ(3,"span",46),e.SDv(4,54),e.qZA(),e.qZA(),e.BQk()}if(2&t){const n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",n.isEcommerce)}}function ut(t,i){if(1&t&&(e.ynx(0),e.YNc(1,_t,5,1,"ng-container",14),e.BQk()),2&t){const n=e.oxw(),o=e.MAs(31);e.xp6(1),e.Q6J("ngIf",n.desiredItemVariantId)("ngIfElse",o)}}function mt(t,i){1&t&&e.GkF(0)}function pt(t,i){if(1&t&&(e.ynx(0),e.YNc(1,mt,1,0,"ng-container",12),e.BQk()),2&t){e.oxw();const n=e.MAs(31);e.xp6(1),e.Q6J("ngTemplateOutlet",n)}}function ht(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"button",55),e.NdJ("click",function(){return e.CHM(n),e.oxw().close()}),e.TgZ(1,"span",46),e.SDv(2,56),e.qZA(),e.qZA()}}function ft(t,i){if(1&t&&(e.ynx(0),e.TgZ(1,"span",59),e.SDv(2,60),e.qZA(),e.TgZ(3,"span",61),e._uU(4),e.ALo(5,"number"),e.qZA(),e.BQk()),2&t){const n=i.ngIf;e.xp6(4),e.hij("",e.xi3(5,1,n,"1.2-2"),"%")}}function Ct(t,i){if(1&t&&(e.TgZ(0,"div",58),e.YNc(1,ft,6,4,"ng-container",23),e.ALo(2,"push"),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,n.chance$))}}function Mt(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Ct,3,3,"div",57),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",!n.isEcommerce)}}function Ut(t,i){1&t&&e.GkF(0)}const xt=function(t,i){return{itemVariant:t,customPrice:i}};function It(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Ut,1,0,"ng-container",37),e.ALo(2,"pluck"),e.BQk()),2&t){const n=e.oxw(2),o=e.MAs(37);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.WLB(5,xt,e.xi3(2,2,n.items[0],"itemVariant"),n.items[0].consumeValue))}}function At(t,i){1&t&&e.GkF(0)}const St=function(t){return{itemVariants:t}};function Et(t,i){if(1&t&&(e.ynx(0),e.YNc(1,At,1,0,"ng-container",37),e.BQk()),2&t){const n=e.oxw(2),o=e.MAs(39);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,St,n.items))}}function Tt(t,i){if(1&t&&(e.YNc(0,It,3,8,"ng-container",23),e.YNc(1,Et,2,4,"ng-container",23)),2&t){const n=e.oxw();e.Q6J("ngIf",1===n.items.length),e.xp6(1),e.Q6J("ngIf",n.items.length>1)}}function vt(t,i){if(1&t&&e._UZ(0,"cw-item",62),2&t){const n=i.itemVariant,o=i.customPrice,r=i.remainderInCoins;e.Q6J("itemVariant",n)("customPrice",o||n.value)("customPriceShowDifference",!1)("banned",!1)("userOwned",!0)("allowOverlay",!0)("rarityRadialBackground",!0)("bonusAmount",r||null)}}function Ot(t,i){if(1&t&&(e._UZ(0,"cw-item-bundle",63),e.ALo(1,"push"),e.ALo(2,"pureFunction"),e.ALo(3,"push"),e.ALo(4,"pureFunction")),2&t){const n=i.itemVariants,o=e.oxw();e.Q6J("itemVariants",e.lcZ(1,4,e.xi3(2,6,o.getConsumeValue,n)))("userOwned",!0)("alwaysOpenBundle",!1)("customPrice",e.lcZ(3,9,e.xi3(4,11,o.getCustomPrice,n)))}}function Pt(t,i){if(1&t&&(e.TgZ(0,"div",64),e.TgZ(1,"span",65),e.SDv(2,66),e.qZA(),e._UZ(3,"cw-pretty-balance",67),e.qZA()),2&t){const n=i.balance;e.xp6(3),e.Q6J("balance",n)}}function Qt(t,i){1&t&&e._UZ(0,"cw-loader",68),2&t&&e.Q6J("loading",!0)("diameter",32)}function Dt(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"button",69),e.NdJ("click",function(){return e.CHM(n),e.oxw().openFairnessModal()}),e._UZ(1,"cw-icon",70),e.TgZ(2,"span",71),e.SDv(3,72),e.qZA(),e.qZA()}}let E=class{constructor(i,n,o,r,s,g,d,h,O,T){this.appConfig=i,this.appNotificationsService=n,this.data=o,this.dialogRef=r,this.toastrService=s,this.quickUpgradeService=g,this.matDialog=d,this.toastNotificationService=h,this.userService=O,this.exchangeRateService=T,this.UpgradeState=p,this.totalValue$=(0,K.of)(0),this.desiredItemVariantId=null,this.nextItemVariant=null,this.diceBetLike=null,this.userCurrency$=this.userService.currency$,this.items=[],this.minBet=1,this.isLoading$=new u.X(!1),this.isSubmitting$=new u.X(!1),this.chance$=new u.X(0),this.remainderInCoins$=new u.X(null),this.upgradeItemVariant$=(0,K.of)(null),this.upgradeLoaderState$=new u.X(_.RESET),this.upgradeState$=new u.X(p.INPUT),this.animationFinished$=new y.x,this.upgradeItemVariantRefresh$=new u.X(0),this.isEcommerce=this.appConfig.siteType===de.NM.ECOMMERCE,this.customErrors={min:`Multiplier should be at least ${this.quickUpgradeService.multiplierMin.toFixed(2)}`,max:`Multiplier should be at most ${this.quickUpgradeService.multiplierMax.toFixed(2)}`,maxMultiplier:()=>{var l,f;return`Multiplier should be at most ${null===(f=null===(l=this.multiplierFormControl)||void 0===l?void 0:l.errors)||void 0===f?void 0:f.maxMultiplier}`}},this.multipleItems=!1,this.maxBetValidator=()=>l=>this.totalValue$.pipe((0,j.O)(null),(0,z.h)(f=>f>0),(0,M.U)(f=>{const k=this.quickUpgradeService.getMaxMultiplier(f).toFixed(2);return k<l.value?{error:!0,maxMultiplier:k}:null})),this.multiplierFormControl=new N.NI(2,[N.kI.required,N.kI.min(this.quickUpgradeService.multiplierMin),N.kI.max(this.quickUpgradeService.multiplierMax+.01)],[this.maxBetValidator()]),this.getCustomPrice=l=>this.convertToUserCurrency(l),this.getConsumeValue=l=>this.convertToUserCurrency(l,f=>f.map(k=>{const{itemVariant:J,consumeValue:Lt}=k;return Object.assign(Object.assign({},J),{displayValue:Lt})}));const{items:v}=this.data;v.length||(this.toastrService.error("No items supplied to Quick upgrade!"),this.dialogRef.close()),this.setUserItem(v),this.isEcommerce&&this.toastNotificationService.createUserItemToastConfig$.next({positionClass:"toast-bottom-right"})}ngOnInit(){(0,c.KWD)(this.multiplierFormControl),this.upgradeItemVariant$=(0,_e.a)([this.multiplierFormControl.valueChanges.pipe((0,j.O)(this.multiplierFormControl.value)),this.upgradeItemVariantRefresh$]).pipe((0,x.b)(()=>{this.isLoading$.next(!0)}),(0,ue.b)(500),(0,V.x)(([i,n],[o,r])=>{const s=i===o&&n===r;return s&&this.isLoading$.next(!1),s}),(0,x.b)(()=>{this.desiredItemVariantId=null,this.isLoading$.next(!0)}),(0,z.h)(()=>this.multiplierFormControl.valid),(0,C.w)(([i])=>this.totalValue$.pipe((0,C.w)(n=>{const o=this.quickUpgradeService.getMinPotentialValue(n,i);return this.quickUpgradeService.getPotentialItems(n,o).pipe((0,q.q)(1),(0,x.b)(r=>{const{value:s}=r||{value:0};this.remainderInCoins$.next(o-s);const d=this.quickUpgradeService.getChanceFromValues(n,n*i);this.chance$.next(d),this.desiredItemVariantId=(null==r?void 0:r.id)||null,this.isLoading$.next(!1)}))}))))}convertToUserCurrency(i,n=(o=>o.reduce((r,{consumeValue:s})=>r+s,0))){return this.userCurrency$.pipe((0,q.q)(1),(0,C.w)(o=>(0,me.D)(i.map(r=>r.currency&&r.currency!==o?this.exchangeRateService.convert(o,r.consumeValue,r.currency).pipe((0,M.U)(s=>Object.assign(Object.assign({},r),{currency:o,consumeValue:s}))):(0,K.of)(r)))),(0,M.U)(n),(0,A.t)(this))}setUserItem(i){this.items=[...i],this.multipleItems=this.items.length>1,this.totalValue$=this.convertToUserCurrency(i),this.multiplierFormControl.setValue(2)}attemptUpgrade(){if(!this.multiplierFormControl.valid)return void(0,c.KWD)(this.multiplierFormControl);if(this.isSubmitting$.getValue())return;this.isSubmitting$.next(!0),this.addDelays(),this.dialogRef.disableClose=!0;const i=this.items.map(({id:o})=>o),n=this.chance$.getValue();this.quickUpgradeService.upgradeItem({userItemIds:i,chance:n,amount:0,choice:F.xk.OVER,desiredItemVariantId:this.desiredItemVariantId,mode:F._Q.MANUAL,rollsPerClick:1}).pipe((0,A.t)(this),(0,x.b)(o=>{if(this.desiredItemVariantId=null,!(null==o?void 0:o.createDiceBets.diceBets.length))return void this.upgradeLoaderState$.next(_.RESET);const[r]=null==o?void 0:o.createDiceBets.diceBets;this.upgradeState$.next(p.UPGRADING),r.won?(this.upgradeLoaderState$.next(_.SUCCESS),this.nextItemVariant=r.wonUserItem):this.upgradeLoaderState$.next(_.FAIL),this.diceBetLike=Object.assign(new F.ue,r)}),(0,pe.x)(()=>{this.isSubmitting$.next(!1)})).subscribe()}animationFinished(){this.animationFinished$.next();const i=this.upgradeLoaderState$.getValue();i===_.SUCCESS?this.upgradeState$.next(p.SUCCESS):i===_.FAIL&&this.upgradeState$.next(p.FAIL),this.dialogRef.disableClose=!1,this.removeDelays()}upgradeAgain(){this.nextItemVariant?(this.setUserItem([this.nextItemVariant]),this.upgradeItemVariantRefresh$.next(this.upgradeItemVariantRefresh$.getValue()+1),this.upgradeLoaderState$.next(_.RESET),this.upgradeState$.next(p.INPUT)):this.close()}openFairnessModal(){this.matDialog.open(Y.BetInfoModalComponent,{width:"800px",data:{bet:this.diceBetLike,betTemplateRef:this.userItemsTpl}})}close(){this.dialogRef.close()}addDelays(){this.userService.userProgressDelays.set(X.l.DICE_BET,this.animationFinished$),[R.a.DICE_UPGRADE_WIN,R.a.DICE_WIN].forEach(i=>this.userService.addDelayToBalanceUpdate(i,this.animationFinished$)),this.appNotificationsService.addDelay(c.xCK.USER_ITEM_DICE_BET,this.animationFinished$)}removeDelays(){this.userService.userProgressDelays.delete(X.l.DICE_BET),[R.a.DICE_UPGRADE_WIN,R.a.DICE_WIN].forEach(i=>this.userService.removeDelayFromBalanceUpdate(i)),this.appNotificationsService.removeDelay(c.xCK.USER_ITEM_DICE_BET)}ngOnDestroy(){this.animationFinished$.next(),this.removeDelays(),this.isEcommerce&&this.toastNotificationService.createUserItemToastConfig$.next({})}};E.\u0275fac=function(i){return new(i||E)(e.Y36(c.qBz),e.Y36(c.n1p),e.Y36(U.WI),e.Y36(U.so),e.Y36(W._W),e.Y36(Q),e.Y36(U.uw),e.Y36($.il),e.Y36(c.KDu),e.Y36(c.UsA))},E.\u0275cmp=e.Xpm({type:E,selectors:[["cw-quick-upgrade-modal"]],viewQuery:function(i,n){if(1&i&&e.Gf(be,5),2&i){let o;e.iGM(o=e.CRH())&&(n.userItemsTpl=o.first)}},hostVars:2,hostBindings:function(i,n){2&i&&e.ekj("multiple-items",n.multipleItems)},features:[e._Bn([Q])],decls:46,vars:17,consts:function(){let t,i,n,o,r,s,g,d,h,O,T,v;return t=$localize`:␟17e868283084a5f0a8ba3126db539cca289c5bb0␟3967603082282265529:Upgrade item`,i=$localize`:␟1e5490bb08f0124c1883423c4b5b3190cde07f42␟1141624910841531405: If your upgrade is successful, you will receive a higher value item and/or credits. `,n=$localize`:␟f2e754b273c0ca17b4ab4da59fe9f8db52e5ffe3␟4513991354604027225: If your upgrade fails, your existing items will be destroyed${"\ufffd#9\ufffd"}:START_TAG_SPAN: - though, you'll receive XP for your loss${"\ufffd/#9\ufffd"}:CLOSE_TAG_SPAN:. `,o=$localize`:␟67eb60f7e60b23219df7ba26a0aa88e1ff768d36␟5493880020176468567:Multiplier`,r=$localize`:␟c479b7ec5d9355c3f35a9a1bd65ffb905f32b0f3␟797001801844718109:Attempt upgrade`,s=$localize`:␟d5f7d32b02bc59b277790b2e93bc5340c4754531␟814017859461999578:success`,g=$localize`:␟f4b3fc68c9b76a61d2e3cdb868b3c76a5839031a␟1404527490106345334:Upgrading...`,d=$localize`:␟5247df03f48f1734c55aa7483399bda0b3c5a7a5␟4542588166735165018:Continue upgrading`,h=$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`,O=$localize`:␟1e035e6ccfab771cad4226b2ad230cb0d4a88cba␟4648900870671159218:Success`,T=$localize`:␟b81106e134a33157c4d4e6cf0b3283151d563434␟1828842198319521826:Upgrade to balance only:`,v=$localize`:␟1a96a81354a1c70767660567cdabcd2cc7fbd88c␟1641971406434557072: Fairness Guaranteed`,[["class","dialog-title","mat-dialog-title","",4,"ngIf"],["class","close-btn","matDialogClose","",3,"inlineSVG",4,"ngIf"],[1,"text-center","mb-3"],t,[1,"description","text-center","mb-2"],i,[1,"description","text-center","mb-4"],n,[1,"d-inline-ecommerce"],[1,"items"],[1,"user-item"],[1,"item"],[4,"ngTemplateOutlet"],[1,"chevron-right"],[4,"ngIf","ngIfElse"],["gamingChevronRight",""],[1,"upgrade-item"],[4,"rxLet"],[1,"input-section"],[1,"attempt-upgrade-btn","text-center"],[3,"ngSwitch"],[4,"ngSwitchCase"],["closeBtn",""],[4,"ngIf"],["userItemsTpl",""],["singleItemTpl",""],["itemBundleTpl",""],["balanceOnlyTpl",""],["loadingTpl",""],["fairnessLinkTpl",""],["mat-dialog-title","",1,"dialog-title"],["mat-icon-button","","mat-dialog-close","",1,"close"],["inlineSVG","assets/icons/close.svg",1,"close-modal-icon"],["matDialogClose","",1,"close-btn",3,"inlineSVG"],["inlineSVG","assets/icons/chevron-upgrade-right.svg",1,"chevron-right-icon"],["inlineSVG","assets/icons/chevron-right.svg",1,"chevron-right-icon"],[3,"state","animationFinished"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"w-100"],[1,"ml-1","h6"],o,[3,"ctrl","minValue","smallButtons","options","hideWhenLTLG","addAndSubtractButton","lastButton","clearButton","maxButton","doubleAndHalfButton","label","errors","icon"],["class","w-100",4,"ngIf"],[1,"text-center"],["mat-flat-button","","color","accent",1,"mat-button-3d",3,"disabled","click"],["class","mr-3 upgrade-icon","inlineSVG","assets/icons/upgrade.svg",4,"ngIf"],[1,"text-uppercase"],r,["inlineSVG","assets/icons/upgrade.svg",1,"mr-3","upgrade-icon"],[1,"font-weight-light"],s,["mat-flat-button","","color","accent",1,"mat-button-3d",3,"disabled"],g,["mat-flat-button","","color","primary","color","accent",1,"mat-button-3d",3,"click"],d,["mat-flat-button","","color","dark",1,"mat-button-3d",3,"click"],h,["class","text-center font-weight-bold mt-2",4,"ngIf"],[1,"text-center","font-weight-bold","mt-2"],[1,"text-capitalize","mr-1"],O,[1,"text-success"],[3,"itemVariant","customPrice","customPriceShowDifference","banned","userOwned","allowOverlay","rarityRadialBackground","bonusAmount"],[3,"itemVariants","userOwned","alwaysOpenBundle","customPrice"],[1,"text-center","d-flex","flex-column","justify-content-center","h-100"],[1,"mr-1"],T,[1,"notranslate",3,"balance"],[3,"loading","diameter"],["mat-button","",1,"fairness-btn",3,"click"],["inlineSVG","assets/icons/shield-check.svg",1,"text-success"],[1,"text-uppercase","text-soft"],v]},template:function(i,n){if(1&i&&(e.YNc(0,Ne,4,0,"span",0),e.TgZ(1,"mat-dialog-content"),e.YNc(2,Re,3,5,"cw-icon",1),e.TgZ(3,"h2",2),e.SDv(4,3),e.qZA(),e.TgZ(5,"p",4),e.SDv(6,5),e.qZA(),e.TgZ(7,"p",6),e.tHW(8,7),e._UZ(9,"span",8),e.N_p(),e.qZA(),e.TgZ(10,"div",9),e.TgZ(11,"div",10),e.TgZ(12,"div",11),e.YNc(13,ye,1,0,"ng-container",12),e.qZA(),e.qZA(),e.TgZ(14,"div",13),e.YNc(15,Be,2,0,"ng-container",14),e.YNc(16,Ge,1,0,"ng-template",null,15,e.W1O),e.qZA(),e.TgZ(18,"div",16),e.TgZ(19,"div",11),e.YNc(20,je,2,1,"ng-container",17),e.qZA(),e.qZA(),e.qZA(),e.TgZ(21,"div",18),e.YNc(22,ot,8,21,"ng-container",17),e.qZA(),e.TgZ(23,"div",19),e.ynx(24,20),e.ALo(25,"push"),e.YNc(26,st,9,9,"ng-container",21),e.YNc(27,gt,5,2,"ng-container",21),e.YNc(28,ut,2,2,"ng-container",21),e.YNc(29,pt,2,1,"ng-container",21),e.YNc(30,ht,3,0,"ng-template",null,22,e.W1O),e.BQk(),e.qZA(),e.YNc(32,Mt,2,1,"ng-container",23),e.ALo(33,"push"),e.qZA(),e.YNc(34,Tt,2,2,"ng-template",null,24,e.W1O),e.YNc(36,vt,1,8,"ng-template",null,25,e.W1O),e.YNc(38,Ot,5,14,"ng-template",null,26,e.W1O),e.YNc(40,Pt,4,1,"ng-template",null,27,e.W1O),e.YNc(42,Qt,1,2,"ng-template",null,28,e.W1O),e.YNc(44,Dt,4,0,"ng-template",null,29,e.W1O)),2&i){const o=e.MAs(17),r=e.MAs(35);e.Q6J("ngIf",!n.isEcommerce),e.xp6(2),e.Q6J("ngIf",n.isEcommerce),e.xp6(11),e.Q6J("ngTemplateOutlet",r),e.xp6(2),e.Q6J("ngIf",n.isEcommerce)("ngIfElse",o),e.xp6(5),e.Q6J("rxLet",n.isLoading$),e.xp6(2),e.Q6J("rxLet",n.upgradeState$),e.xp6(2),e.Q6J("ngSwitch",e.lcZ(25,13,n.upgradeState$)),e.xp6(2),e.Q6J("ngSwitchCase",n.UpgradeState.INPUT),e.xp6(1),e.Q6J("ngSwitchCase",n.UpgradeState.UPGRADING),e.xp6(1),e.Q6J("ngSwitchCase",n.UpgradeState.SUCCESS),e.xp6(1),e.Q6J("ngSwitchCase",n.UpgradeState.FAIL),e.xp6(3),e.Q6J("ngIf",e.lcZ(33,15,n.upgradeState$)===n.UpgradeState.INPUT)}},directives:[m.O5,U.xY,m.tP,H.e,m.RF,m.n9,U.uh,he.lW,U.ZT,fe.o,Ce.d$,S,Te.l,ve.P,Oe._,Pe.q,Qe.R],pipes:[ee.f,m.Ov,De.n,m.JJ,Le.F,$e.M],styles:[".close-btn[_ngcontent-%COMP%]{position:absolute;top:-.75rem;right:0;padding:.75rem;background:var(--modal-border-color)}.description[_ngcontent-%COMP%]{color:var(--quick-upgrade-subtitle-color)}.chevron-right[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:1rem;padding:1rem 0}@media (min-width: 576px){.chevron-right[_ngcontent-%COMP%]{width:2rem;transform:none;padding:0}}.chevron-right-icon[_ngcontent-%COMP%]{color:var(--quick-upgrade-right-chevron);width:.75rem}@media (min-width: 576px){.chevron-right-icon[_ngcontent-%COMP%]{width:1.2rem}}.upgrade-icon[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem}.dialog-title[_ngcontent-%COMP%]{height:0;margin-bottom:0}.input-section[_ngcontent-%COMP%]{display:flex;min-height:10rem;justify-content:center;align-items:center;padding:0 .5rem}.fairness-btn[_ngcontent-%COMP%]{display:block;margin:0 auto!important}@media (min-width: 576px){.fairness-btn[_ngcontent-%COMP%]{margin:0}}cw-loader[_ngcontent-%COMP%]{display:flex;justify-content:center;height:100%;align-items:center}.items[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:0 -24px}.user-item[_ngcontent-%COMP%], .upgrade-item[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:calc(50% - .5rem)}@media (min-width: 576px){.user-item[_ngcontent-%COMP%], .upgrade-item[_ngcontent-%COMP%]{min-height:19rem;width:calc(50% - 1rem)}}.item[_ngcontent-%COMP%]{height:100%;width:90%}.item[_ngcontent-%COMP%]   cw-item[_ngcontent-%COMP%]{height:100%}.attempt-upgrade-btn[_ngcontent-%COMP%]{margin:0 -1.5rem 1rem}.attempt-upgrade-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;min-height:3rem}@media (min-width: 576px){.attempt-upgrade-btn[_ngcontent-%COMP%]{margin:0}}.d-inline-ecommerce[_ngcontent-%COMP%]{display:none}.ecommerce-site[_nghost-%COMP%]   .d-inline-ecommerce[_ngcontent-%COMP%], .ecommerce-site   [_nghost-%COMP%]   .d-inline-ecommerce[_ngcontent-%COMP%]{display:inline}.ecommerce-site[_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .item-grid, .ecommerce-site   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .item-grid{height:61%!important}.ecommerce-site[_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .name, .ecommerce-site   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .name{visibility:hidden}.gaming-site[_nghost-%COMP%]   .chevron-right-icon[_ngcontent-%COMP%], .gaming-site   [_nghost-%COMP%]   .chevron-right-icon[_ngcontent-%COMP%]{width:2.2rem}.gaming-site   [_nghost-%COMP%]     cw-amount-input img{width:.7rem!important;margin-bottom:-.7rem;margin-right:.5rem!important}.gaming-site[_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .item-grid, .gaming-site   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .item-grid{min-height:13rem!important}@media (min-width: 576px){.gaming-site[_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .item-grid, .gaming-site   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]     cw-item-bundle .item-grid{height:70%!important}}@media (max-width: 767.98px){.gaming-site   .multiple-items[_nghost-%COMP%]   .upgrade-item[_ngcontent-%COMP%]     cw-item .item{padding:35% .25rem .25rem!important}.gaming-site   .multiple-items[_nghost-%COMP%]   .upgrade-item[_ngcontent-%COMP%]     cw-item .bg-img{top:15%!important}}[_nghost-%COMP%]     cw-item .item{padding:.25rem!important}@media (min-width: 576px){[_nghost-%COMP%]     cw-item .item{padding:1rem!important}}[_nghost-%COMP%]     cw-item .shipping-cost{left:1.25rem}[_nghost-%COMP%]     cw-amount-input mat-form-field{margin-top:0}[_nghost-%COMP%]     cw-amount-input img{margin-bottom:-.65rem;margin-right:0!important}[_nghost-%COMP%]     cw-amount-input input{margin-top:.4rem;font-weight:600}  .quick-upgrade-modal .mat-dialog-container{background:var(--quick-upgrade-modal-bg, var(--modal-bg));background-clip:border-box;overflow:visible}  .quick-upgrade-modal .mat-dialog-content{max-height:calc(100vh - 3.5rem)}@media (min-width: 576px){  .quick-upgrade-modal .mat-dialog-content{max-height:inherit}}"],changeDetection:0}),E=(0,b.gn)([(0,A.c)(),(0,b.w6)("design:paramtypes",[Object,c.n1p,Object,U.so,W._W,Q,U.uw,$.il,c.KDu,c.UsA])],E)},95642:(ie,L,a)=>{a.d(L,{Eh:()=>M,S8:()=>Z});var m=a(75424),c=a(39478),w=a(23600);const P=c.Ps`
  fragment UserItemDiceBet on UserItem {
    id
    createdAt
    consumeValue
    currency
    itemVariant {
      ...ItemVariant
    }
  }

  ${w.xp8}
`,C=c.Ps`
  fragment QuickUpgradeBet on DiceBet {
    id
    createdAt
    houseEdgePercent
    choice
    profit
    won
    chance
    roll {
      id
      value
      nonce
      clientSeed {
        id
        value
      }
      serverSeed {
        id
        value
      }
    }
    user {
      ...UserBadge
    }
    wonUserItem {
      ...UserItemDiceBet
    }
  }

  ${m.userBadgeFragment}
  ${P}
`,M=c.Ps`
  mutation CreateDiceBets($input: CreateDiceBetsInput!) {
    createDiceBets(input: $input) {
      diceBets {
        ...QuickUpgradeBet
      }
    }
  }

  ${C}
`,Z=c.Ps`
  query DiceBets($after: String, $first: PaginationAmount, $orderBy: [DiceBetOrderBy], $userId: ID, $gameTypes: [DiceGameType!]) {
    diceBets(after: $after, first: $first, orderBy: $orderBy, userId: $userId, gameTypes: $gameTypes) {
      pageInfo {
        hasNextPage
        endCursor
      }
      edges {
        node {
          ...QuickUpgradeBet
          betItems {
            userItem {
              itemVariant {
                iconUrl
                name
                rarity
              }
              currency
              consumedValue
            }
          }
        }
      }
    }
  }

  ${C}
`}}]);